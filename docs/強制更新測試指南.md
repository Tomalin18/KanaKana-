# 強制更新功能測試指南

## 概述

本指南提供在真正上架之前測試強制更新功能的完整方法。

## 🧪 測試方法

### 1. 腳本測試

#### 運行場景測試
```bash
cd scripts
node test-update-scenarios.js
```

這個腳本會測試：
- 版本比較邏輯
- 不同版本場景
- API調用
- 模擬應用內檢查

#### 運行Expo版本檢查測試
```bash
cd scripts
node test-expo-version.js
```

這個腳本模擬Expo環境中的版本檢查。

### 2. 開發環境測試

#### 方法一：修改app.json版本號
1. 將 `app.json` 中的版本號改為較低版本（如 `0.9.0`）
2. 重新啟動Expo應用
3. 觀察是否顯示更新提示

```json
{
  "expo": {
    "version": "0.9.0",  // 改為較低版本
    "ios": {
      "buildNumber": "1"
    },
    "android": {
      "versionCode": 1
    }
  }
}
```

#### 方法二：使用Expo Go測試
1. 構建開發版本
2. 在Expo Go中運行
3. 測試更新提示界面

### 3. 模擬不同場景

#### 場景1：正常更新提示
- 當前版本：1.0.0
- 最新版本：1.1.0
- 預期結果：顯示可選更新提示

#### 場景2：強制更新
- 當前版本：0.9.0
- 最新版本：1.1.0
- 最低要求：1.0.0
- 預期結果：顯示強制更新提示

#### 場景3：已是最新版本
- 當前版本：1.1.0
- 最新版本：1.1.0
- 預期結果：不顯示更新提示

## 📱 實際測試步驟

### 步驟1：準備測試環境
```bash
# 啟動開發環境
./scripts/start-dev.sh

# 在另一個終端啟動Expo
npx expo start
```

### 步驟2：測試版本檢查
```bash
# 測試API
cd scripts && node test-real-api.js

# 測試場景
node test-update-scenarios.js
```

### 步驟3：測試應用內功能
1. 在Expo Go中打開應用
2. 檢查控制台日誌
3. 觀察版本檢查過程
4. 測試更新提示界面

### 步驟4：測試錯誤處理
1. 斷開網絡連接
2. 重新啟動應用
3. 觀察錯誤處理
4. 恢復網絡連接
5. 測試重試功能

## 🔧 測試檢查清單

### API測試
- [ ] API端點可訪問
- [ ] 認證Token有效
- [ ] 響應格式正確
- [ ] 版本號解析正確

### 版本比較測試
- [ ] 語義化版本比較正確
- [ ] 不同版本場景處理正確
- [ ] 邊界情況處理正確

### 用戶界面測試
- [ ] 更新提示界面顯示正確
- [ ] 版本信息顯示正確
- [ ] 按鈕功能正常
- [ ] 應用商店跳轉正常

### 錯誤處理測試
- [ ] 網絡錯誤處理
- [ ] API錯誤處理
- [ ] 離線模式處理
- [ ] 重試機制正常

### 平台特定測試
- [ ] iOS版本檢查正常
- [ ] Android版本檢查正常
- [ ] 平台特定URL正確

## 🐛 常見問題和解決方案

### 問題1：版本檢查不工作
**解決方案**：
- 檢查API端點是否正確
- 確認認證Token有效
- 檢查網絡連接

### 問題2：更新提示不顯示
**解決方案**：
- 確認當前版本低於最新版本
- 檢查版本比較邏輯
- 查看控制台日誌

### 問題3：應用商店跳轉失敗
**解決方案**：
- 檢查URL格式
- 確認應用商店ID正確
- 測試URL可訪問性

### 問題4：強制更新不生效
**解決方案**：
- 檢查最低要求版本設置
- 確認版本比較邏輯
- 測試強制更新場景

## 📊 測試報告模板

### 測試環境
- 測試日期：
- 測試平台：iOS/Android
- 測試版本：
- 測試設備：

### 測試結果
- [ ] API連接測試：通過/失敗
- [ ] 版本比較測試：通過/失敗
- [ ] 更新提示測試：通過/失敗
- [ ] 錯誤處理測試：通過/失敗
- [ ] 應用商店跳轉：通過/失敗

### 發現的問題
1. 問題描述：
   - 嚴重程度：
   - 解決方案：

### 建議
1. 改進建議：
2. 優化點：

## 🚀 上架前最終檢查

### 必須完成的測試
- [ ] 所有測試場景通過
- [ ] 實際設備測試完成
- [ ] 錯誤處理驗證完成
- [ ] 用戶體驗測試完成

### 配置檢查
- [ ] API端點配置正確
- [ ] 認證Token配置正確
- [ ] 應用商店URL配置正確
- [ ] 版本號配置正確

### 文檔檢查
- [ ] 測試報告完成
- [ ] 問題記錄完整
- [ ] 解決方案文檔化

## 💡 最佳實踐

1. **測試環境隔離**：使用專門的測試API端點
2. **版本管理**：使用語義化版本號
3. **錯誤監控**：記錄版本檢查錯誤
4. **用戶反饋**：收集用戶更新體驗反饋
5. **漸進式發布**：考慮分階段發布更新

## 📞 支持

如果遇到問題，請：
1. 查看控制台日誌
2. 運行測試腳本
3. 檢查配置設置
4. 參考故障排除指南 