# 詞彙資料庫重構方案總結

## 🎯 重構目標

將分散的詞彙檔案整合為統一的服務架構，提高開發效率和系統可維護性。

## 📊 現狀分析

### 當前問題
- **檔案分散**: 11,357個單字分布在20+個檔案中
- **重複代碼**: 多個索引檔案和重複的介面定義
- **管理困難**: 新增詞彙需要修改多個檔案
- **擴展限制**: 新增遊戲模式需要重新整合詞彙

### 資料統計
- **總詞彙數**: 11,357個單字
- **檔案數量**: 20+個分散檔案
- **遊戲模式**: 4個 (經典、俄羅斯方塊、漢字、長文)
- **難度等級**: 4個 (初級、中級、高級、專家級)
- **JLPT等級**: N3、N2詞彙已整合

## 🏗️ 新架構設計

### 目錄結構
```
src/data/vocabulary/
├── core/           # 核心組件 (類型定義、工具函數)
├── data/           # 詞彙資料 (JSON格式)
├── services/       # 服務層 (詞彙服務、查詢服務)
└── adapters/       # 適配器層 (遊戲模式適配器)
```

### 核心組件
1. **VocabularyService**: 統一的詞彙管理服務
2. **GameModeAdapter**: 遊戲模式適配器
3. **QueryService**: 高效查詢服務
4. **CacheService**: 快取機制

### 統一資料結構
```typescript
interface VocabularyWord {
  id: string;                    // 唯一識別碼
  word: string;                  // 日文單字
  kana: string;                  // 假名讀音
  meaning: string;               // 英文意思
  difficulty: DifficultyLevel;   // 難度等級
  category: string;              // 分類
  tags: string[];                // 標籤陣列
  jlptLevel?: string;            // JLPT等級
  gameModes: string[];           // 適用遊戲模式
  // ... 其他欄位
}
```

## 📅 實施計劃

### 階段1: 準備階段 (1-2天)
- [ ] 創建新目錄結構
- [ ] 定義統一介面
- [ ] 設置開發環境

### 階段2: 資料整合 (2-3天)
- [ ] 編寫資料轉換腳本
- [ ] 執行資料轉換
- [ ] 去重和標籤化處理
- [ ] 資料驗證

### 階段3: 服務實現 (2-3天)
- [ ] 實現核心服務類
- [ ] 實現適配器
- [ ] 單元測試

### 階段4: 遊戲模式更新 (2-3天)
- [ ] 更新所有遊戲模式
- [ ] 向後相容性測試

### 階段5: 測試和優化 (1-2天)
- [ ] 整合測試
- [ ] 性能測試
- [ ] 部署準備

## 🛠️ 技術實現

### 核心服務
```typescript
// 詞彙服務
const service = VocabularyService.getInstance();
await service.initialize();

// 查詢詞彙
const words = service.query({
  difficulty: 'normal',
  gameModes: ['classic'],
  jlptLevel: 'n3'
});

// 獲取隨機詞彙
const randomWord = service.getRandom({
  difficulty: 'normal',
  gameModes: ['tetris']
});
```

### 遊戲模式適配器
```typescript
// 經典模式
const classicWords = GameModeAdapter.forClassicMode('intermediate');

// 俄羅斯方塊模式
const tetrisWords = GameModeAdapter.forTetrisMode('normal', 'hiragana');

// 漢字模式
const kanjiWords = GameModeAdapter.forKanjiMode('n3');

// 向後相容
const word = GameModeAdapter.getRandomWord('intermediate', 'classic');
```

### 資料轉換
```typescript
// 執行資料轉換
await VocabularyMigrator.migrateAllFiles();

// 結果: 統一的JSON格式詞彙檔案
// - all-words.json (所有詞彙)
// - beginner.json (初級詞彙)
// - normal.json (中級詞彙)
// - hard.json (高級詞彙)
// - expert.json (專家級詞彙)
// - jlpt/n3.json, jlpt/n2.json (JLPT詞彙)
```

## 📈 預期效益

### 技術效益
- **開發效率提升**: 統一API，減少重複代碼
- **維護成本降低**: 單一資料來源，清晰架構
- **性能優化**: 快取機制，高效查詢
- **可擴展性**: 易於新增遊戲模式和詞彙分類

### 業務效益
- **管理效率**: 統一管理所有詞彙
- **用戶體驗**: 更豐富的詞彙分類和智能推薦
- **擴展性**: 支援未來功能擴展

## 🚨 風險管理

### 技術風險
- **資料丟失**: 建立完整備份和回滾機制
- **相容性問題**: 保持向後相容性
- **性能問題**: 充分測試和優化

### 緩解措施
- 分階段實施，每階段都有可交付物
- 充分測試，確保功能正常
- 建立監控機制，及時發現問題

## 📋 檢查清單

### 準備階段
- [ ] 備份現有詞彙檔案
- [ ] 創建新目錄結構
- [ ] 安裝必要依賴
- [ ] 創建核心類型定義

### 實現階段
- [ ] 實現 VocabularyService
- [ ] 實現 GameModeAdapter
- [ ] 創建資料轉換腳本
- [ ] 執行資料轉換

### 整合階段
- [ ] 更新經典模式
- [ ] 更新俄羅斯方塊模式
- [ ] 更新漢字模式
- [ ] 更新長文模式

### 測試階段
- [ ] 單元測試
- [ ] 整合測試
- [ ] 性能測試
- [ ] 向後相容性測試

## 📞 支援資源

### 文件
- **完整技術方案**: `docs/詞彙資料庫重構技術方案.md`
- **實施指南**: `docs/詞彙重構實施指南.md`
- **當前狀態**: `docs/JLPT詞彙遊戲整合完成報告.md`

### 腳本
- **資料轉換**: `scripts/migrate-vocabulary.ts`
- **測試腳本**: `scripts/test-vocabulary.ts`
- **驗證腳本**: `scripts/validate-vocabulary.ts`

### 關鍵檔案
- **現有詞彙**: `src/data/vocabulary-final/`
- **新架構**: `src/data/vocabulary/`
- **遊戲模式**: `src/screens/game-modes/`

## 🎯 下一步行動

1. **技術評審**: 工程師團隊評審技術方案
2. **資源規劃**: 確定實施時間和人員安排
3. **開始實施**: 按照實施指南開始重構
4. **定期檢查**: 定期檢查進度和質量

---

**這個重構方案將為KanaKana建立現代化的詞彙管理系統，提高開發效率和系統可維護性。** 